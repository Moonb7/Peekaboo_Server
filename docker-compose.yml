version: '3.8'

services:
  distributor:
    image: 442042527855.dkr.ecr.ap-northeast-2.amazonaws.com/test-node/distributor:latest
    container_name: distributor
    hostname: distributor
    networks:
      - peekaboo-network
    ports:
      - '6030:6030'
    env_file:
      - ./packages/common/config/.env

  game:
    image: 442042527855.dkr.ecr.ap-northeast-2.amazonaws.com/test-node/game:latest
    container_name: game
    hostname: game
    networks:
      - peekaboo-network
    ports:
      - '6050:6050'
    env_file:
      - ./packages/common/config/.env
    depends_on:
      - distributor
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  lobby:
    image: 442042527855.dkr.ecr.ap-northeast-2.amazonaws.com/test-node/lobby:latest
    container_name: lobby
    hostname: lobby
    networks:
      - peekaboo-network
    ports:
      - '6010:6010'
    env_file:
      - ./packages/common/config/.env
    depends_on:
      - game

  account:
    image: 442042527855.dkr.ecr.ap-northeast-2.amazonaws.com/test-node/account:latest
    container_name: account
    hostname: account
    networks:
      - peekaboo-network
    ports:
      - '6020:6020'
    env_file:
      - ./packages/common/config/.env
    depends_on:
      - lobby

  session:
    image: 442042527855.dkr.ecr.ap-northeast-2.amazonaws.com/test-node/session:latest
    container_name: session
    hostname: session
    networks:
      - peekaboo-network
    ports:
      - '6040:6040'
    env_file:
      - ./packages/common/config/.env
    depends_on:
      - account

  gateway:
    image: 442042527855.dkr.ecr.ap-northeast-2.amazonaws.com/test-node/gateway:latest
    container_name: gateway
    hostname: gateway
    networks:
      - peekaboo-network
    ports:
      - '6000:6000'
    env_file:
      - ./packages/common/config/.env
    depends_on:
      - session

networks:
  peekaboo-network:
    driver: bridge
